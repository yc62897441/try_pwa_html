<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>PWA To-Do List with Vanilla JS</title>

        <!-- 傳到 github page 要加的 -->
        <link rel="canonical" href="https://yc62897441.github.io/try_pwa_html/" />

        <link rel="stylesheet" href="./src/main.css" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans" />
        <link rel="manifest" href="./manifest.json" />

        <!-- Safari -->
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="#CC7412" />
        <meta name="apple-mobile-web-app-title" content="To-Do List" />
        <link rel="apple-touch-icon" href="/src/images/icons/apple-icon-60x60.png" />
        <link rel="apple-touch-icon" href="/src/images/icons/apple-icon-128x128.png" />
        <link rel="apple-touch-icon" href="/src/images/icons/apple-icon-512x512.png" />
    </head>
    <body>
        <header class="header">
            <img class="logo" src="./src/assets/img/checklist.png" alt="" />
            <div class="unfinished">
                <span class="count">0</span>
                <span>個未完成</span>
            </div>
        </header>
        <section>
            <div class="input-content">
                <img id="add" class="add button-img" src="./src/assets/img/plus.png" alt="" />
                <input
                    id="todoInput"
                    class="input"
                    placeholder="What need to be done?"
                    type="text"
                />
            </div>
        </section>
        <section id="todoList"></section>

        <script async>
            async function init() {
                try {
                    async function registerServerWorker() {
                        try {
                            // local 端使用
                            let registerUrl = '/sw.js'
                            let option = {}

                            // 如果不是 local 端，要加上 github page repository 的 url
                            if (!window.location.host.includes('127.0.0.1')) {
                                registerUrl = '/try_pwa_html/sw.js'
                                option = { scope: '/try_pwa_html/' }
                            }

                            if ('serviceWorker' in navigator) {
                                await navigator.serviceWorker
                                    .register(registerUrl, option)
                                    .then((reg) => console.log('完成 SW 設定!', reg))
                                    .catch((err) => console.log('Error!', err))
                            }
                        } catch (error) {
                            console.log('error', error)
                        }
                    }
                    await registerServerWorker()
                    console.log('Server Worker 註冊完成')
                } catch (error) {}
            }
            init()
        </script>

        <script src="./main.js"></script>
    </body>
</html>
